Sub CMMS(ByVal perC As Long, ByVal perL As Long)Dim i, j, k As Integer'Worksheets("Datos").Activatei = Worksheets("Datos").Cells(Rows.Count, 1).End(xlUp).Offset(0, 0).Row'j = Worksheets("Datos").Cells(1, Columns.Count).End(xlToLeft).Offset(0, 0).Columnj = 5'Worksheets("Datos").Columns(j + 1).ClearContents'Worksheets("Datos").Columns(j + 2).ClearContentsWorksheets("Datos").Range("F:G").ClearContents'Poniendo etiquetasWorksheets("Datos").Cells(1, j + 1) = "MMS(" & perC & ")"Worksheets("Datos").Cells(1, j + 2) = "MMS(" & perL & ")"For k = (perC + 1) To i    Worksheets("Datos").Cells(k, j + 1).Value = Application.WorksheetFunction.Average(Range(Worksheets("Datos").Cells(k - perC + 1, j), Worksheets("Datos").Cells(k, j)))Next kFor k = (perL + 1) To i    Worksheets("Datos").Cells(k, j + 2).Value = Application.WorksheetFunction.Average(Range(Worksheets("Datos").Cells(k - perL + 1, j), Worksheets("Datos").Cells(k, j)))Next kEnd Sub''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''Codifique aqui''''''''''''''''''''Sub CMMPAd()' Media Movil Simple, calculada hacia adelante' Da una mayor importancia a los precios mas recientes en la serie de precios'+----------------+------------+--------+'| name                     | letter | column |'+----------------+------------+--------+'| Date                       | A      |      1 |'| Open                      | B      |      2 |'| High                       | C      |      3 |'| Low                        | D      |      4 |'| Close                      | E      |      5 |'| MMS Corta              | F      |      6 |'| MMS Larga              | G     |      7 |'| MMS Atras              | H     |      8 |'| MMS Adelante         | I      |      9 |'| MM Exponencial      | J      |     10 |'+----------------+--------+--------+k = 4'Definimos la matriz de pesos    ReDim weights(1 To k, 1 To 1) As Double' Rotulo    Worksheets("Datos").Cells(1, 9) = "MMS Adelante (" & k & ")"    ' Tamaño de la serie de datos para los precios    N = Worksheets("Datos").Cells(Rows.Count, 1).End(xlUp).Row' Fijamos al ponderador W, que depende del tamaño k de la media movil    w = 2 / (k * (k + 1))    ' Creamos la serie de ponderadores    For i = 1 To k       weights(i, 1) = i * w    Next i    ' Calculamos los pronosticos bajo este metodo    For i = k + 1 To N                rango_inicio = Cells(i + 1 - k, 5).Address        rango_fin = Range(rango_inicio).Offset(k - 1, 0).Address                precios = Range(rango_inicio, rango_fin)        result = Application.WorksheetFunction.SumProduct(precios, weights)                Worksheets("Datos").Cells(i, 9) = result            Next iEnd SubSub CMMPAt()' Media Movil Simple calculada hacia atras'+----------------+------------+--------+'| name                     | letter | column |'+----------------+------------+--------+'| Date                       | A      |      1 |'| Open                      | B      |      2 |'| High                       | C      |      3 |'| Low                        | D      |      4 |'| Close                      | E      |      5 |'| MMS Corta              | F      |      6 |'| MMS Larga              | G     |      7 |'| MMS Atras              | H     |      8 |'| MMS Adelante         | I      |      9 |'| MM Exponencial      | J      |     10 |'+----------------+--------+--------+k = 4'Dim weights(1 To k) As VariantReDim weights(1 To k, 1 To 1) As Double' Rotulo    Worksheets("Datos").Cells(1, 8) = "MMS Atras (" & k & ")"' Tamaño de la serie de datos para los precios    N = Worksheets("Datos").Cells(Rows.Count, 1).End(xlUp).Row' Fijamos al ponderador W, que depende del tamaño k de la media movil    w = 2 / (k * (k + 1))    ' Creamos la serie de ponderadores    For i = 1 To k       weights(i, 1) = (k + 1 - i) * w    Next i             ' Calculamos los pronosticos bajo este metodo    For i = k + 1 To N                Cells(i, 8).Select        Cells(i + 1 - k, 5).Select        rango_inicio = Cells(i + 1 - k, 5).Address        Range(rango_inicio).Offset(k - 1, 0).Select        rango_fin = Range(rango_inicio).Offset(k - 1, 0).Address        precios = Range(rango_inicio, rango_fin)                result = Application.WorksheetFunction.SumProduct(precios, weights)                                Worksheets("Datos").Cells(i, 8) = result            Next iRange("a1").Select    End SubSub CMME()' Codigo para la media movil exponencial' Consideraciones:' Su principal función es generar pronósticos, se ajusta mejor a la serie de precios y le da mayor importancia a los datos más recientes.' K es el parametro que recibe la Media Movil Exponencial para realizar su analisis y tiene un impacto en alpha' alpha nos ayuda a sabeer el comportamiento de nuestros valores:    ' Si alpha -> 1, Pronositico se parece a los valores actuales de la serie    ' Si alpha -> 0, Pronositico se parece a los anteriores estimados    '+----------------+------------+--------+'| name                     | letter | column |'+----------------+------------+--------+'| Date                       | A      |      1 |'| Open                      | B      |      2 |'| High                       | C      |      3 |'| Low                        | D      |      4 |'| Close                      | E      |      5 |'| MMS Corta              | F      |      6 |'| MMS Larga              | G     |      7 |'| MMS Atras              | H     |      8 |'| MMS Adelante         | I      |      9 |'| MM Exponencial      | J      |     10 |'+----------------+--------+--------+k = 4' Rotulo    Worksheets("Datos").Cells(1, 10) = "MME(" & k & ")"' Tamaño de la serie de datos    N = Worksheets("Datos").Cells(Rows.Count, 1).End(xlUp).Row' Llenamos la serie de datos -----------------------------------------------------------------    alpha = 2 / (k + 1)' Primer valor: MMS(k)    mms_inicio = Worksheets("Datos").Cells(2, 5).Address    mms_fin = Worksheets("Datos").Cells(k + 1, 5).Address    Set rango_mms = Range(mms_inicio, mms_fin)        mms = WorksheetFunction.Average(rango_mms)    Worksheets("Datos").Cells(k + 1, 10) = mms' Valores siguientes    For i = k + 2 To N                X = Worksheets("Datos").Cells(i, 5).Value        X_ = Worksheets("Datos").Cells(i - 1, 10).Value                Worksheets("Datos").Cells(i, 10) = alpha * X + (1 - alpha) * X_            Next i'-------------------------------------------------------------------------------------------End SubSub GraficaSenal()    Dim R1, R2 As Integer    Dim min, max As Double    Dim datX, datCie, datMMC, datMML As Range        'Generando gráfico de Señales    'Determinar los límites del vector de graficación    R1 = Worksheets("Datos").Cells(1, "G").End(xlDown).Row    R2 = Worksheets("Datos").Cells(10000, "G").End(xlUp).Row              'Modificamos los parámetros de la gráfica     'Obtenemos mínimo y máximo    min = Round(Application.WorksheetFunction.min(Range(Worksheets("Datos").Cells(R1, 5), Worksheets("Datos").Cells(R2, 8)))) - 5    max = Round(Application.WorksheetFunction.max(Range(Worksheets("Datos").Cells(R1, 5), Worksheets("Datos").Cells(R2, 8)))) + 5        'Seleccionando nueva serie de datos    Set datX = Range(Worksheets("Datos").Cells(R1, 1), Worksheets("Datos").Cells(R2, 1))    Set datCie = Range(Worksheets("Datos").Cells(R1, 5), Worksheets("Datos").Cells(R2, 5))    Set datMMC = Range(Worksheets("Datos").Cells(R1, 6), Worksheets("Datos").Cells(R2, 6))    Set datMML = Range(Worksheets("Datos").Cells(R1, 7), Worksheets("Datos").Cells(R2, 7))        'Obteniendo rótulo    N = Sheets("Aux").Cells(1, 3)        'Modificando serie de datos    Worksheets("Graficos").Activate        'Haciendo visible el gráfico    Worksheets("Graficos").ChartObjects("Senal").Visible = True    ActiveSheet.ChartObjects("Senal").Activate    ActiveChart.ChartTitle.Text = "Señales: " & Sheets("Aux").Cells(N, 2)        ' Datos cierre ---------------------------------------    ActiveChart.FullSeriesCollection(1).XValues = datX    ActiveChart.FullSeriesCollection(1).Name = "Close"    ActiveChart.FullSeriesCollection(1).Values = datCie        ' MMS Corta ----------------------------------------    ActiveChart.FullSeriesCollection(2).XValues = datX    ActiveChart.FullSeriesCollection(2).Name = Worksheets("Datos").Cells(1, "F")    ActiveChart.FullSeriesCollection(2).Values = datMMC        ' MMS Larga -----------------------------------------    ActiveChart.FullSeriesCollection(3).XValues = datX    ActiveChart.FullSeriesCollection(3).Name = Worksheets("Datos").Cells(1, "G")    ActiveChart.FullSeriesCollection(3).Values = datMML        ' Escala de la grafica ----------------------------------    ActiveChart.Axes(xlValue).Select    ActiveChart.Axes(xlValue).MinimumScale = min    ActiveChart.Axes(xlValue).MaximumScale = max    Cells(5, "B").SelectEnd SubSub maestroMM()    Dim ren, tipo As Integer    Dim perC, perL As Long    'Solo en casos que rechace el tipo el inputbox utilice este tipo    'Dim perC, PerL As Variant            'Call GraficaSenal    'Identificando el tipo de media móvil    tipo = Worksheets("Aux").Cells(1, 3)        'Número de renglones en Datos. Incluye rótulo    ren = Worksheets("Datos").Cells(Rows.Count, 1).End(xlUp).Row     'i = 5 Mod 1        'Recibiendo datos del usuario VBA ver 365    perC = Application.InputBox("Dame el tamaño de la MM Corta", "Ingrese parámetro de entrada", Type:=1)    perL = Application.InputBox("Dame el tamaño de la MM Larga", "Ingrese parámetro de entrada", Type:=1)        'Recibiendo datos del usuario VBA otras versiones elija la que se acople    'perC = InputBox("Dame el tamaño de la MM Corta", "Ingrese parámetro de entrada", Type:=1)    'perL = InputBox("Dame el tamaño de la MM Larga", "Ingrese parámetro de entrada", Type:=1)        'Modificando variables de entrada en caso que el usuario ingrese decimales negativos    perC = Int(Abs(perC))    perL = Int(Abs(perL))        If 0 < (perL - perC) And perC <> 0 And 5 < (ren - perL) Then    Application.Calculation = xlCalculationManual        If tipo = 1 Then            Call CMMS(perC, perL)        ElseIf tipo = 2 Then            Call CMMPAd(perC, perL)        ElseIf tipo = 3 Then            Call CMMPAt(perC, perL)        Else            Call CMME(perC, perL)        End If        Call GraficaSenal    Application.Calculation = xlCalculationAutomatic    Else        MsgBox "Ingrese nuevamente las MM dispone de: " & (ren - 1) & " observaciones", vbOKOnly + vbExclamation, "Media móvil inválida"        'Limpiando hoja de Datos        Worksheets("Datos").Range("F:G").Clear        'Ocultando gráfico        Worksheets("Graficos").ChartObjects("Senale").Visible = False        Worksheets("Graficos").Cells(5, "B").Select    End IfEnd Sub